name: CodeQL Analysis

on:
    schedule:
        - cron: "0 6,18 * * *" # Twice daily at 6am and 6pm UTC
    workflow_dispatch:

concurrency:
    group: codeql-${{ github.ref }}
    cancel-in-progress: true

permissions:
    contents: read
    security-events: write
    actions: read

jobs:
    codeql:
        name: CodeQL Analysis
        runs-on: blacksmith-2vcpu-ubuntu-2404
        timeout-minutes: 30
        steps:
            - name: Checkout repository
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # tag v6.0.2

            - name: Initialize CodeQL
              uses: github/codeql-action/init@9e907b5e64f6b83e7804b09294d44122997950d6 # tag v4.32.3
              with:
                  languages: rust
                  config-file: ./.github/codeql/codeql-config.yml

            - name: Set up Rust
              uses: dtolnay/rust-toolchain@e97e2d8cc328f1b50210efc529dca0028893a2d9 # tag v1
              with:
                  toolchain: stable

            - name: Build
              run: cargo build --workspace --all-targets

            - name: Perform CodeQL Analysis
              uses: github/codeql-action/analyze@9e907b5e64f6b83e7804b09294d44122997950d6 # tag v4.32.3
